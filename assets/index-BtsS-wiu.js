import{g as a,s as E,u as k,w as L,x as F}from"./index-CdlL2fon.js";function T(e){return!(e.metaKey||!F()&&e.altKey||e.ctrlKey||e.key==="Control"||e.key==="Shift"||e.key==="Meta")}var M=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);function H(e,r,t){const n=t?L(t):null,i=a(n);return e=e||n instanceof i.HTMLInputElement&&!M.has(n?.type)||n instanceof i.HTMLTextAreaElement||n instanceof i.HTMLElement&&n.isContentEditable,!(e&&r==="keyboard"&&t instanceof i.KeyboardEvent&&!Reflect.has(K,t.key))}var s=null,v=new Set,c=new Map,u=!1,f=!1,K={Tab:!0,Escape:!0};function l(e,r){for(let t of v)t(e,r)}function d(e){u=!0,T(e)&&(s="keyboard",l("keyboard",e))}function o(e){s="pointer",(e.type==="mousedown"||e.type==="pointerdown")&&(u=!0,l("pointer",e))}function b(e){k(e)&&(u=!0,s="virtual")}function w(e){const r=L(e);r===a(r)||r===E(r)||(!u&&!f&&(s="virtual",l("virtual",e)),u=!1,f=!1)}function g(){u=!1,f=!0}function C(e){if(typeof window>"u"||c.get(a(e)))return;const r=a(e),t=E(e);let n=r.HTMLElement.prototype.focus;function i(){s="virtual",l("virtual",null),u=!0,n.apply(this,arguments)}try{Object.defineProperty(r.HTMLElement.prototype,"focus",{configurable:!0,value:i})}catch{}t.addEventListener("keydown",d,!0),t.addEventListener("keyup",d,!0),t.addEventListener("click",b,!0),r.addEventListener("focus",w,!0),r.addEventListener("blur",g,!1),typeof r.PointerEvent<"u"?(t.addEventListener("pointerdown",o,!0),t.addEventListener("pointermove",o,!0),t.addEventListener("pointerup",o,!0)):(t.addEventListener("mousedown",o,!0),t.addEventListener("mousemove",o,!0),t.addEventListener("mouseup",o,!0)),r.addEventListener("beforeunload",()=>{V(e)},{once:!0}),c.set(r,{focus:n})}var V=(e,r)=>{const t=a(e),n=E(e),i=c.get(t);if(i){try{Object.defineProperty(t.HTMLElement.prototype,"focus",{configurable:!0,value:i.focus})}catch{}n.removeEventListener("keydown",d,!0),n.removeEventListener("keyup",d,!0),n.removeEventListener("click",b,!0),t.removeEventListener("focus",w,!0),t.removeEventListener("blur",g,!1),typeof t.PointerEvent<"u"?(n.removeEventListener("pointerdown",o,!0),n.removeEventListener("pointermove",o,!0),n.removeEventListener("pointerup",o,!0)):(n.removeEventListener("mousedown",o,!0),n.removeEventListener("mousemove",o,!0),n.removeEventListener("mouseup",o,!0)),c.delete(t)}};function m(){return s==="keyboard"}function S(e={}){const{isTextInput:r,autoFocus:t,onChange:n,root:i}=e;C(i),n?.({isFocusVisible:t||m(),modality:s});const p=(y,h)=>{H(!!r,y,h)&&n?.({isFocusVisible:m(),modality:y})};return v.add(p),()=>{v.delete(p)}}export{m as i,S as t};
