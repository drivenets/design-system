import{c as f}from"./use-locale-context-BbVyF5Ga.js";import{d as g,O as v,M as y,r as N,b as P,g as U,w as E,p as A,P as M}from"./index-BGvA3V6P.js";import{r as p}from"./iframe-C3gMQG0U.js";function O(e,t={}){const{sync:s=!1}=t,a=C(e);return p.useCallback((...n)=>s?queueMicrotask(()=>a.current?.(...n)):a.current?.(...n),[s,a])}function C(e){const t=p.useRef(e);return t.current=e,t}const[w,D]=f({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"});function S(e,t){const{state:s,send:a,context:n}=e,r=s.matches("mounted","unmountSuspended");return{skip:!n.get("initial"),present:r,setNode(i){i&&a({type:"NODE.SET",node:i})},unmount(){a({type:"UNMOUNT"})}}}var x=g({props({props:e}){return{...e,present:!!e.present}},initialState({prop:e}){return e("present")?"mounted":"unmounted"},refs(){return{node:null,styles:null}},context({bindable:e}){return{unmountAnimationName:e(()=>({defaultValue:null})),prevAnimationName:e(()=>({defaultValue:null})),present:e(()=>({defaultValue:!1})),initial:e(()=>({sync:!0,defaultValue:!1}))}},exit:["cleanupNode"],watch({track:e,prop:t,send:s}){e([()=>t("present")],()=>{s({type:"PRESENCE.CHANGED"})})},on:{"NODE.SET":{actions:["setupNode"]},"PRESENCE.CHANGED":{actions:["setInitial","syncPresence"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]},"UNMOUNT.SUSPEND":{target:"unmountSuspended"}}},unmountSuspended:{effects:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},UNMOUNT:{target:"unmounted",actions:["clearPrevAnimationName","invokeOnExitComplete"]}}},unmounted:{on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}},implementations:{actions:{setInitial:({context:e})=>{e.get("initial")||queueMicrotask(()=>{e.set("initial",!0)})},invokeOnExitComplete:({prop:e,refs:t})=>{e("onExitComplete")?.();const s=t.get("node");if(!s)return;const a=U(s),n=new a.CustomEvent("exitcomplete",{bubbles:!1});s.dispatchEvent(n)},setupNode:({refs:e,event:t})=>{e.get("node")!==t.node&&(e.set("node",t.node),e.set("styles",P(t.node)))},cleanupNode:({refs:e})=>{e.set("node",null),e.set("styles",null)},syncPresence:({context:e,refs:t,send:s,prop:a})=>{const n=a("present");if(n)return s({type:"MOUNT",src:"presence.changed"});const r=t.get("node");if(!n&&r?.ownerDocument.visibilityState==="hidden")return s({type:"UNMOUNT",src:"visibilitychange"});N(()=>{const i=m(t.get("styles"));e.set("unmountAnimationName",i),i==="none"||i===e.get("prevAnimationName")||t.get("styles")?.display==="none"||t.get("styles")?.animationDuration==="0s"?s({type:"UNMOUNT",src:"presence.changed"}):s({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName:({context:e,refs:t})=>{N(()=>{e.set("prevAnimationName",m(t.get("styles")))})},clearPrevAnimationName:({context:e})=>{e.set("prevAnimationName",null)}},effects:{trackAnimationEvents:({context:e,refs:t,send:s,prop:a})=>{const n=t.get("node");if(!n)return;const r=o=>{(o.composedPath?.()?.[0]??o.target)===n&&e.set("prevAnimationName",m(t.get("styles")))},i=o=>{const c=m(t.get("styles"));E(o)===n&&c===e.get("unmountAnimationName")&&!a("present")&&s({type:"UNMOUNT",src:"animationend"})},u=o=>{E(o)===n&&!a("present")&&s({type:"UNMOUNT",src:"animationcancel"})};n.addEventListener("animationstart",r),n.addEventListener("animationcancel",u),n.addEventListener("animationend",i);const l=v(n,{animationFillMode:"forwards"});return()=>{n.removeEventListener("animationstart",r),n.removeEventListener("animationcancel",u),n.removeEventListener("animationend",i),y(()=>l())}}}}});function m(e){return e?.animationName||"none"}A()(["onExitComplete","present","immediate"]);const L=(e={})=>{const{lazyMount:t,unmountOnExit:s,present:a,skipAnimationOnMount:n=!1,...r}=e,i=p.useRef(!1),u={...r,present:a,onExitComplete:O(e.onExitComplete)},l=M(x,u),o=S(l);o.present&&(i.current=!0);const c=!o.present&&!i.current&&t||s&&!o.present&&i.current,d=()=>({"data-state":o.skip&&n?void 0:a?"open":"closed",hidden:!o.present});return{ref:o.setNode,getPresenceProps:d,present:o.present,unmounted:c}};export{w as P,D as a,O as b,L as u};
