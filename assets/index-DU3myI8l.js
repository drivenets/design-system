import{r as v,s as S,g as z,y as j,z as k,A as C,w as T,B as N,C as X,D as G,i as I,E as D,F as J,G as M,H as K,I as V,J as Q,K as Z}from"./index-BPfzXCyR.js";function ee(e){const t={each(n){for(let s=0;s<e.frames?.length;s+=1){const r=e.frames[s];r&&n(r)}},addEventListener(n,s,r){return t.each(i=>{try{i.document.addEventListener(n,s,r)}catch{}}),()=>{try{t.removeEventListener(n,s,r)}catch{}}},removeEventListener(n,s,r){t.each(i=>{try{i.document.removeEventListener(n,s,r)}catch{}})}};return t}function te(e){const t=e.frameElement!=null?e.parent:null;return{addEventListener:(n,s,r)=>{try{t?.addEventListener(n,s,r)}catch{}return()=>{try{t?.removeEventListener(n,s,r)}catch{}}},removeEventListener:(n,s,r)=>{try{t?.removeEventListener(n,s,r)}catch{}}}}var W="pointerdown.outside",_="focus.outside";function ne(e){for(const t of e)if(I(t)&&X(t))return!0;return!1}var U=e=>"clientY"in e;function se(e,t){if(!U(t)||!e)return!1;const n=e.getBoundingClientRect();return n.width===0||n.height===0?!1:n.top<=t.clientY&&t.clientY<=n.top+n.height&&n.left<=t.clientX&&t.clientX<=n.left+n.width}function re(e,t){return e.y<=t.y&&t.y<=e.y+e.height&&e.x<=t.x&&t.x<=e.x+e.width}function R(e,t){if(!t||!U(e))return!1;const n=t.scrollHeight>t.clientHeight,s=n&&e.clientX>t.offsetLeft+t.clientWidth,r=t.scrollWidth>t.clientWidth,i=r&&e.clientY>t.offsetTop+t.clientHeight,f={x:t.offsetLeft,y:t.offsetTop,width:t.clientWidth+(n?16:0),height:t.clientHeight+(r?16:0)},l={x:e.clientX,y:e.clientY};return re(f,l)?s||i:!1}function ie(e,t){const{exclude:n,onFocusOutside:s,onPointerDownOutside:r,onInteractOutside:i,defer:f,followControlledElements:l=!0}=t;if(!e)return;const p=S(e),w=z(e),L=ee(w),b=te(w);function P(a,d){if(!I(d)||!d.isConnected||D(e,d)||se(e,a)||l&&J(e,d))return!1;const h=p.querySelector(`[aria-controls="${e.id}"]`);if(h){const y=M(h);if(R(a,y))return!1}const m=M(e);return R(a,m)?!1:!n?.(d)}const E=new Set,x=j(e?.getRootNode());function o(a){function d(h){const m=f&&!C()?v:O=>O(),y=h??a,A=y?.composedPath?.()??[y?.target];m(()=>{const O=x?A[0]:T(a);if(!(!e||!P(a,O))){if(r||i){const $=N(r,i);e.addEventListener(W,$,{once:!0})}Y(e,W,{bubbles:!1,cancelable:!0,detail:{originalEvent:y,contextmenu:G(y),focusable:ne(A),target:O}})}})}a.pointerType==="touch"?(E.forEach(h=>h()),E.add(k(p,"click",d,{once:!0})),E.add(b.addEventListener("click",d,{once:!0})),E.add(L.addEventListener("click",d,{once:!0}))):d()}const c=new Set,B=setTimeout(()=>{c.add(k(p,"pointerdown",o,!0)),c.add(b.addEventListener("pointerdown",o,!0)),c.add(L.addEventListener("pointerdown",o,!0))},0);function g(a){(f?v:h=>h())(()=>{const h=a?.composedPath?.()??[a?.target],m=x?h[0]:T(a);if(!(!e||!P(a,m))){if(s||i){const y=N(s,i);e.addEventListener(_,y,{once:!0})}Y(e,_,{bubbles:!1,cancelable:!0,detail:{originalEvent:a,contextmenu:!1,focusable:X(m),target:m}})}})}return C()||(c.add(k(p,"focusin",g,!0)),c.add(b.addEventListener("focusin",g,!0)),c.add(L.addEventListener("focusin",g,!0))),()=>{clearTimeout(B),E.forEach(a=>a()),c.forEach(a=>a())}}function oe(e,t){const{defer:n}=t,s=n?v:i=>i(),r=[];return r.push(s(()=>{const i=typeof e=="function"?e():e;r.push(ie(i,t))})),()=>{r.forEach(i=>i?.())}}function Y(e,t,n){const s=e.ownerDocument.defaultView||window,r=new s.CustomEvent(t,n);return e.dispatchEvent(r)}function ae(e,t){const n=s=>{s.key==="Escape"&&(s.isComposing||t?.(s))};return k(S(e),"keydown",n,{capture:!0})}var q="layer:request-dismiss",u={layers:[],branches:[],count(){return this.layers.length},pointerBlockingLayers(){return this.layers.filter(e=>e.pointerBlocking)},topMostPointerBlockingLayer(){return[...this.pointerBlockingLayers()].slice(-1)[0]},hasPointerBlockingLayer(){return this.pointerBlockingLayers().length>0},isBelowPointerBlockingLayer(e){const t=this.indexOf(e),n=this.topMostPointerBlockingLayer()?this.indexOf(this.topMostPointerBlockingLayer()?.node):-1;return t<n},isTopMost(e){return this.layers[this.count()-1]?.node===e},getNestedLayers(e){return Array.from(this.layers).slice(this.indexOf(e)+1)},getLayersByType(e){return this.layers.filter(t=>t.type===e)},getNestedLayersByType(e,t){const n=this.indexOf(e);return n===-1?[]:this.layers.slice(n+1).filter(s=>s.type===t)},getParentLayerOfType(e,t){const n=this.indexOf(e);if(!(n<=0))return this.layers.slice(0,n).reverse().find(s=>s.type===t)},countNestedLayersOfType(e,t){return this.getNestedLayersByType(e,t).length},isInNestedLayer(e,t){return this.getNestedLayers(e).some(n=>D(n.node,t))},isInBranch(e){return Array.from(this.branches).some(t=>D(t,e))},add(e){this.layers.push(e),this.syncLayers()},addBranch(e){this.branches.push(e)},remove(e){const t=this.indexOf(e);t<0||(t<this.count()-1&&this.getNestedLayers(e).forEach(s=>u.dismiss(s.node,e)),this.layers.splice(t,1),this.syncLayers())},removeBranch(e){const t=this.branches.indexOf(e);t>=0&&this.branches.splice(t,1)},syncLayers(){this.layers.forEach((e,t)=>{e.node.style.setProperty("--layer-index",`${t}`),e.node.removeAttribute("data-nested"),e.node.removeAttribute("data-has-nested"),this.getParentLayerOfType(e.node,e.type)&&e.node.setAttribute("data-nested",e.type);const s=this.countNestedLayersOfType(e.node,e.type);s>0&&e.node.setAttribute("data-has-nested",e.type),e.node.style.setProperty("--nested-layer-count",`${s}`)})},indexOf(e){return this.layers.findIndex(t=>t.node===e)},dismiss(e,t){const n=this.indexOf(e);if(n===-1)return;const s=this.layers[n];ue(e,q,r=>{s.requestDismiss?.(r),r.defaultPrevented||s?.dismiss()}),ce(e,q,{originalLayer:e,targetLayer:t,originalIndex:n,targetIndex:t?this.indexOf(t):-1}),this.syncLayers()},clear(){this.remove(this.layers[0].node)}};function ce(e,t,n){const s=e.ownerDocument.defaultView||window,r=new s.CustomEvent(t,{cancelable:!0,bubbles:!0,detail:n});return e.dispatchEvent(r)}function ue(e,t,n){e.addEventListener(t,n,{once:!0})}var F;function H(){u.layers.forEach(({node:e})=>{e.style.pointerEvents=u.isBelowPointerBlockingLayer(e)?"none":"auto"})}function le(e){e.style.pointerEvents=""}function de(e,t){const n=S(e),s=[];return u.hasPointerBlockingLayer()&&!n.body.hasAttribute("data-inert")&&(F=document.body.style.pointerEvents,queueMicrotask(()=>{n.body.style.pointerEvents="none",n.body.setAttribute("data-inert","")})),t?.forEach(r=>{const[i,f]=Q(()=>{const l=r();return I(l)?l:null},{timeout:1e3});i.then(l=>s.push(Z(l,{pointerEvents:"auto"}))),s.push(f)}),()=>{u.hasPointerBlockingLayer()||(queueMicrotask(()=>{n.body.style.pointerEvents=F,n.body.removeAttribute("data-inert"),n.body.style.length===0&&n.body.removeAttribute("style")}),s.forEach(r=>r()))}}function fe(e,t){const{warnOnMissingNode:n=!0}=t;if(n&&!e){V("[@zag-js/dismissable] node is `null` or `undefined`");return}if(!e)return;const{onDismiss:s,onRequestDismiss:r,pointerBlocking:i,exclude:f,debug:l,type:p="dialog"}=t,w={dismiss:s,node:e,type:p,pointerBlocking:i,requestDismiss:r};u.add(w),H();function L(o){const c=T(o.detail.originalEvent);u.isBelowPointerBlockingLayer(e)||u.isInBranch(c)||(t.onPointerDownOutside?.(o),t.onInteractOutside?.(o),!o.defaultPrevented&&(l&&console.log("onPointerDownOutside:",o.detail.originalEvent),s?.()))}function b(o){const c=T(o.detail.originalEvent);u.isInBranch(c)||(t.onFocusOutside?.(o),t.onInteractOutside?.(o),!o.defaultPrevented&&(l&&console.log("onFocusOutside:",o.detail.originalEvent),s?.()))}function P(o){u.isTopMost(e)&&(t.onEscapeKeyDown?.(o),!o.defaultPrevented&&s&&(o.preventDefault(),s()))}function E(o){if(!e)return!1;const c=typeof f=="function"?f():f,B=Array.isArray(c)?c:[c],g=t.persistentElements?.map(a=>a()).filter(I);return g&&B.push(...g),B.some(a=>D(a,o))||u.isInNestedLayer(e,o)}const x=[i?de(e,t.persistentElements):void 0,ae(e,P),oe(e,{exclude:E,onFocusOutside:b,onPointerDownOutside:L,defer:t.defer})];return()=>{u.remove(e),H(),le(e),x.forEach(o=>o?.())}}function ye(e,t){const{defer:n}=t,s=n?v:i=>i(),r=[];return r.push(s(()=>{const i=K(e)?e():e;r.push(fe(i,t))})),()=>{r.forEach(i=>i?.())}}function Ee(e,t={}){const{defer:n}=t,s=n?v:i=>i(),r=[];return r.push(s(()=>{const i=K(e)?e():e;if(!i){V("[@zag-js/dismissable] branch node is `null` or `undefined`");return}u.addBranch(i),r.push(()=>{u.removeBranch(i)})})),()=>{r.forEach(i=>i?.())}}export{Ee as a,ye as t};
