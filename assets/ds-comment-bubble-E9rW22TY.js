import{j as e}from"./jsx-runtime-u17CrQMm.js";import{r as l}from"./iframe-CElvGea5.js";import{c as I}from"./index-C1hHQqhM.js";import{D as E}from"./ds-thread-item-B58r6TWf.js";import{D as x}from"./ds-button-ApHgQ92K.js";import{D as G}from"./ds-checkbox-qzsvHBt9.js";import{D as _}from"./ds-icon-Cmuf6_qW.js";import{D as J}from"./ds-tag-5e4Iu0kX.js";import{a as m}from"./ds-dropdown-menu-I0yfuM_V.js";import{m as Q}from"./merge-refs-DX9dreSa.js";const X="_iconButtonContent_1wy94_1",Y="_bubble_1wy94_8",Z="_actionRequired_1wy94_19",ee="_initial_1wy94_23",ne="_inputArea_1wy94_29",te="_inputWrapper_1wy94_34",se="_textarea_1wy94_40",re="_typing_1wy94_51",ae="_thread_1wy94_67",ie="_header_1wy94_86",oe="_headerLeft_1wy94_96",de="_headerInfo_1wy94_103",ce="_commentId_1wy94_109",le="_actionRequiredBadge_1wy94_115",ue="_headerRight_1wy94_122",me="_headerActions_1wy94_128",ge="_headerActionButton_1wy94_139",pe="_footer_1wy94_206",he="_actionRequiredCheckbox_1wy94_213",fe="_checked_1wy94_213",ye="_dropdownContent_1wy94_226",ve="_danger_1wy94_246",n={iconButtonContent:X,bubble:Y,actionRequired:Z,initial:ee,inputArea:ne,inputWrapper:te,textarea:se,typing:re,thread:ae,header:ie,headerLeft:oe,headerInfo:de,commentId:ce,actionRequiredBadge:le,headerRight:ue,headerActions:me,headerActionButton:ge,footer:pe,actionRequiredCheckbox:he,checked:fe,dropdownContent:ye,danger:ve},_e="_thread_1d789_1",we="_initialComment_1d789_10",Ce="_followingComments_1d789_15",xe="_overflowShadow_1d789_36",be="_visible_1d789_49",b={thread:_e,initialComment:we,followingComments:Ce,overflowShadow:xe,visible:be},qe=(a,s,d=!0)=>{l.useEffect(()=>{if(!d||!s)return;const r=i=>{a.current&&!a.current.contains(i.target)&&s()};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[a,s,d])},Te=(a,s,d=480)=>{l.useLayoutEffect(()=>{const r=a.current;r&&(r.style.height="auto",r.style.height=`${String(Math.min(r.scrollHeight,d))}px`)},[a,s,d])},je=(a,s)=>{const[d,r]=l.useState(!1);return l.useLayoutEffect(()=>{const i=a.current;if(!i)return;const c=()=>{const f=i.scrollHeight>i.clientHeight,y=i.scrollTop>0;r(f&&y)};return c(),i.addEventListener("scroll",c,{passive:!0}),()=>{i.removeEventListener("scroll",c)}},[a,s]),d},S=({messages:a,commentAuthor:s,currentUser:d,onEditMessage:r,onDeleteMessage:i,onMarkUnread:c,onResolved:f,className:y})=>{const g=l.useRef(null),w=l.useRef(null),o=a.find(t=>t.isInitialMessage)||a[0],q=a.filter(t=>t.id!==o?.id),R=je(g,a.length);l.useEffect(()=>{w.current?.scrollIntoView({behavior:"smooth"})},[a.length]);const k=t=>d?.id===t.id,T=t=>s.id===t.id,u=t=>k(t);return o?e.jsxs("div",{className:I(b.thread,y),children:[e.jsxs("div",{className:b.initialComment,children:[e.jsx(E,{id:o.id,author:o.author,content:o.content,createdAt:o.createdAt,isCommentAuthorMessage:T(o.author),canModify:u(o.author),onEdit:u(o.author)?r:void 0,onDelete:u(o.author)?i:void 0,onMarkUnread:c,onResolved:f}),e.jsx("div",{className:I(b.overflowShadow,{[b.visible]:R})})]}),q.length>0&&e.jsxs("div",{ref:g,className:b.followingComments,children:[q.map(t=>e.jsx(E,{id:t.id,author:t.author,content:t.content,createdAt:t.createdAt,isCommentAuthorMessage:T(t.author),canModify:u(t.author),onEdit:u(t.author)?r:void 0,onDelete:u(t.author)?i:void 0,onMarkUnread:c,onResolved:f},t.id)),e.jsx("div",{ref:w})]})]}):null};S.__docgenInfo={description:"",methods:[],displayName:"DsCommentThread",props:{messages:{required:!0,tsType:{name:"Array",elements:[{name:"CommentMessage"}],raw:"CommentMessage[]"},description:""},commentAuthor:{required:!0,tsType:{name:"CommentAuthor"},description:""},currentUser:{required:!1,tsType:{name:"CommentAuthor"},description:""},onEditMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"(messageId: string, newContent: string) => void",signature:{arguments:[{type:{name:"string"},name:"messageId"},{type:{name:"string"},name:"newContent"}],return:{name:"void"}}},description:""},onDeleteMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"(messageId: string) => void",signature:{arguments:[{type:{name:"string"},name:"messageId"}],return:{name:"void"}}},description:""},onMarkUnread:{required:!1,tsType:{name:"signature",type:"function",raw:"(messageId: string) => void",signature:{arguments:[{type:{name:"string"},name:"messageId"}],return:{name:"void"}}},description:""},onResolved:{required:!1,tsType:{name:"signature",type:"function",raw:"(messageId: string) => void",signature:{arguments:[{type:{name:"string"},name:"messageId"}],return:{name:"void"}}},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};const Ie=({ref:a,comment:s,currentUser:d,actionRequired:r=!1,onActionRequiredChange:i,value:c="",onValueChange:f,onSend:y,onClose:g,onResolve:w,onToggleActionRequired:o,onForward:q,onMarkUnread:R,onCopyLink:k,onDelete:T,onEditMessage:u,onDeleteMessage:t,onMessageMarkUnread:z,onMessageResolved:L,referenceTag:j,className:H,style:O})=>{const p=!!s?.messages.length,C=c.trim().length>0,N=!p&&C,v=!p&&!C,D=p?"Reply":"Add a comment",U=N,$=p&&!!s,V=480,M=l.useRef(null),W=Q(a,M),B=l.useRef(null),F=l.useCallback(()=>{v&&g?.()},[v,g]);qe(M,F,v),Te(B,c,V);const A=()=>{C&&y&&y(c,r)},K=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),A())},P=()=>j?typeof j=="string"?e.jsx(J,{size:"small",label:j,slots:{icon:e.jsx(_,{icon:"sell",size:"tiny"})}}):j:null;return e.jsxs("div",{ref:W,className:I(n.bubble,{[n.actionRequired]:r,[n.initial]:v,[n.typing]:N,[n.thread]:p},H),style:O,role:"dialog","aria-label":v?"Add new comment":`Comment thread${s?.numericId?` #${String(s.numericId)}`:""}`,children:[$&&s&&e.jsxs("div",{className:n.header,children:[e.jsx("div",{className:n.headerLeft,children:e.jsxs("div",{className:n.headerInfo,children:[e.jsxs("span",{className:n.commentId,children:["#",s.numericId]}),P(),r&&e.jsx("span",{className:n.actionRequiredBadge,children:"Action required"})]})}),e.jsxs("div",{className:n.headerRight,children:[e.jsxs("div",{className:n.headerActions,children:[e.jsxs(m.Root,{children:[e.jsx(m.Trigger,{asChild:!0,children:e.jsx(x,{design:"v1.2",buttonType:"tertiary",size:"small","aria-label":"More actions",className:n.headerActionButton,contentClassName:n.iconButtonContent,children:e.jsx(_,{icon:"more_vert",size:"tiny"})})}),e.jsxs(m.Content,{className:n.dropdownContent,children:[e.jsx(m.Item,{value:"toggle-action",onClick:o,children:r?"Remove action requirement":"Require action"}),e.jsx(m.Item,{value:"forward",onClick:q,children:"Forward"}),e.jsx(m.Item,{value:"mark-unread",onClick:R,children:"Mark as 'Unread'"}),e.jsx(m.Item,{value:"copy-link",onClick:k,children:"Copy link"}),e.jsx(m.Item,{value:"delete",onClick:T,className:n.danger,children:"Delete"})]})]}),w&&e.jsx(x,{design:"v1.2",buttonType:"tertiary",size:"small",onClick:()=>w(),"aria-label":"Resolve",className:n.headerActionButton,contentClassName:n.iconButtonContent,children:e.jsx(_,{icon:"check_circle",size:"tiny"})})]}),g&&e.jsx(x,{design:"v1.2",buttonType:"tertiary",size:"small",onClick:()=>g(),className:n.headerActionButton,contentClassName:n.iconButtonContent,"aria-label":"Close",children:e.jsx(_,{icon:"close",size:"tiny"})})]})]}),p&&s&&e.jsx(S,{messages:s.messages,commentAuthor:s.author,currentUser:d,onEditMessage:u,onDeleteMessage:t,onMarkUnread:z,onResolved:L}),e.jsxs("div",{className:n.inputArea,children:[e.jsx("div",{className:n.inputWrapper,children:e.jsx("textarea",{ref:B,className:n.textarea,placeholder:D,value:c,onChange:h=>f?.(h.target.value),onKeyDown:K,rows:1,"aria-label":D})}),(v||p)&&e.jsx(x,{design:"v1.2",size:"small",disabled:!C,onClick:A,"aria-label":"Send",children:e.jsx(_,{icon:"send",size:"tiny"})})]}),U&&e.jsxs("div",{className:n.footer,children:[e.jsx(G,{label:"Action required",checked:r,onCheckedChange:h=>i?.(h===!0),className:I(n.actionRequiredCheckbox,{[n.checked]:r})}),e.jsx(x,{design:"v1.2",size:"small",disabled:!C,onClick:A,"aria-label":"Send",children:e.jsx(_,{icon:"send",size:"tiny"})})]})]})};Ie.__docgenInfo={description:"",methods:[],displayName:"DsCommentBubble",props:{ref:{required:!1,tsType:{name:"Ref",elements:[{name:"HTMLDivElement"}],raw:"Ref<HTMLDivElement>"},description:""},comment:{required:!1,tsType:{name:"CommentData"},description:""},currentUser:{required:!1,tsType:{name:"CommentAuthor"},description:""},actionRequired:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onActionRequiredChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(checked: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"checked"}],return:{name:"void"}}},description:""},value:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}},onValueChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: string) => void",signature:{arguments:[{type:{name:"string"},name:"value"}],return:{name:"void"}}},description:""},onSend:{required:!1,tsType:{name:"signature",type:"function",raw:"(content: string, actionRequired: boolean) => void",signature:{arguments:[{type:{name:"string"},name:"content"},{type:{name:"boolean"},name:"actionRequired"}],return:{name:"void"}}},description:""},onClose:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onResolve:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onToggleActionRequired:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onForward:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onMarkUnread:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onCopyLink:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onDelete:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onEditMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"(messageId: string, newContent: string) => void",signature:{arguments:[{type:{name:"string"},name:"messageId"},{type:{name:"string"},name:"newContent"}],return:{name:"void"}}},description:""},onDeleteMessage:{required:!1,tsType:{name:"signature",type:"function",raw:"(messageId: string) => void",signature:{arguments:[{type:{name:"string"},name:"messageId"}],return:{name:"void"}}},description:""},onMessageMarkUnread:{required:!1,tsType:{name:"signature",type:"function",raw:"(messageId: string) => void",signature:{arguments:[{type:{name:"string"},name:"messageId"}],return:{name:"void"}}},description:""},onMessageResolved:{required:!1,tsType:{name:"signature",type:"function",raw:"(messageId: string) => void",signature:{arguments:[{type:{name:"string"},name:"messageId"}],return:{name:"void"}}},description:""},referenceTag:{required:!1,tsType:{name:"ReactNode"},description:""},className:{required:!1,tsType:{name:"string"},description:""},style:{required:!1,tsType:{name:"CSSProperties"},description:""}}};export{Ie as D};
